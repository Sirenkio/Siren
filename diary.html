<!DOCTYPE html>
<html lang="zh">
<head>
   <link rel='apple-touch-icon' href='https://em-content.zobj.net/thumbs/240/apple/325/ribbon_1f380.png'>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çŒ«çš„æ¯æ—¥æ—¥è®°</title>
    <meta name="theme-color" content="#c9a9a6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å°çŒ«æ—¥è®°">
    
    <!-- ä¸»å±å¹•å›¾æ ‡è®¾ç½® -->
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ğŸ““&lt;/text&gt;&lt;/svg&gt;">
    <link rel="apple-touch-icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 style=%22background-color:%23c9a9a6%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22 fill=%22white%22&gt;ğŸ““&lt;/text&gt;&lt;/svg&gt;">
    <style>
        :root {
            --primary: #c9a9a6;
            --primary-light: #d4b8b5;
            --secondary: #f6eeee;
            --dark: #333333;
            --light: #f8f8f8;
            --danger: #ff6b6b;
            --success: #4CAF50;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .diary-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .diary-controls button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .diary-controls button:hover {
            background-color: var(--primary-light);
        }
        
        #delete-btn {
            background-color: var(--danger);
        }
        
        #delete-btn:hover {
            background-color: #ff4444;
        }
        
        #search-container {
            display: flex;
            gap: 10px;
        }
        
        #search-input {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            flex-grow: 1;
        }
        
        .diary-content {
            display: flex;
            gap: 20px;
            flex: 1;
        }
        
        .diary-entries {
            width: 300px;
            border-right: 1px solid #eee;
            padding-right: 20px;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .entry-card {
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            margin-bottom: 15px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .entry-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        
        .entry-card.selected {
            border-left: 4px solid var(--primary);
        }
        
        .entry-card h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .entry-card p {
            margin: 0;
            color: #888;
            font-size: 0.8rem;
        }
        
        .entry-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        #entry-title {
            font-size: 1.2rem;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        #entry-editor {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 300px;
            resize: none;
            width: 100%;
            box-sizing: border-box;
            line-height: 1.5;
            font-family: inherit;
        }
        
        #mood-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #mood-selector select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .action-btns {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }
        
        #save-btn {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        #save-btn:hover {
            background-color: #45a049;
        }
        
        .empty-state {
            text-align: center;
            margin-top: 100px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--primary);
            color: white;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .diary-content {
                flex-direction: column;
            }
            
            .diary-entries {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eee;
                padding-right: 0;
                padding-bottom: 20px;
                margin-bottom: 20px;
                max-height: 200px;
            }
            
            .diary-controls {
                flex-direction: column;
            }
            
            #search-container {
                width: 100%;
            }
        }
        
        .mood-icon {
            font-size: 1.2rem;
            margin-right: 5px;
        }
        
        .tags-container {
            margin-bottom: 15px;
        }
        
        .tags-input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-top: 5px;
        }
        
        .tag-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }
        
        .statistics {
            background-color: var(--secondary);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .statistics h3 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
    </style>
    <!-- Web App Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{
      "name": "å°çŒ«çš„æ¯æ—¥æ—¥è®°",
      "short_name": "å°çŒ«æ—¥è®°",
      "description": "è®°å½•æ¯ä¸€å¤©çš„ç§å¯†æ—¥è®°æœ¬",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#c9a9a6",
      "theme_color": "#c9a9a6",
      "icons": [
        {
          "src": "data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 style=%22background-color:%23c9a9a6%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22 fill=%22white%22%3EğŸ““%3C/text%3E%3C/svg%3E",
          "sizes": "512x512",
          "type": "image/svg+xml",
          "purpose": "any maskable"
        }
      ]
    }'>
</head>
<body>
    <header>
        <h1>å°çŒ«çš„æ¯æ—¥æ—¥è®°</h1>
    </header>
    
    <div class="container">
        <div class="statistics">
            <h3>ç»Ÿè®¡ä¿¡æ¯</h3>
            <div class="stat-item">
                <span>æ—¥è®°æ€»æ•°ï¼š</span>
                <span id="total-entries">0</span>
            </div>
            <div class="stat-item">
                <span>æœ¬æœˆæ—¥è®°ï¼š</span>
                <span id="month-entries">0</span>
            </div>
            <div class="stat-item">
                <span>æœ€å¸¸ç”¨å¿ƒæƒ…ï¼š</span>
                <span id="common-mood">æš‚æ— æ•°æ®</span>
            </div>
            <div class="stat-item">
                <span>æœ€è¿‘ä¸€æ¬¡è®°å½•ï¼š</span>
                <span id="last-entry">æš‚æ— æ•°æ®</span>
            </div>
        </div>
        
        <div class="diary-controls">
            <button id="new-entry-btn">å†™æ–°æ—¥è®°</button>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="æœç´¢æ—¥è®°...">
                <button id="search-btn">æœç´¢</button>
            </div>
            <button id="delete-btn">åˆ é™¤é€‰ä¸­</button>
        </div>
        
        <div class="diary-content">
            <div class="diary-entries" id="entries-container">
                <!-- æ—¥è®°æ¡ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="entry-content">
                <input type="text" id="entry-title" placeholder="æ—¥è®°æ ‡é¢˜...">
                
                <div id="mood-selector">
                    <label for="mood">ä»Šæ—¥å¿ƒæƒ…ï¼š</label>
                    <select id="mood">
                        <option value="happy">ğŸ˜Š å¼€å¿ƒ</option>
                        <option value="calm">ğŸ˜Œ å¹³é™</option>
                        <option value="sad">ğŸ˜¢ ä¼¤å¿ƒ</option>
                        <option value="angry">ğŸ˜  ç”Ÿæ°”</option>
                        <option value="excited">ğŸ˜ƒ å…´å¥‹</option>
                        <option value="tired">ğŸ˜´ ç–²æƒ«</option>
                        <option value="loved">ğŸ’• è¢«çˆ±</option>
                        <option value="anxious">ğŸ˜° ç„¦è™‘</option>
                    </select>
                </div>
                
                <div class="tags-container">
                    <label for="tags">æ ‡ç­¾ï¼š</label>
                    <input type="text" id="tags" class="tags-input" placeholder="è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”...">
                    <div class="tag-hint">ä¾‹å¦‚ï¼šä¸»äººï¼Œç©å…·ï¼Œæ„Ÿæƒ³ï¼Œå›å¿†...</div>
                </div>
                
                <textarea id="entry-editor" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆæƒ³æ³•å’Œæ„Ÿå—..."></textarea>
                
                <div class="action-btns">
                    <button id="save-btn">ä¿å­˜æ—¥è®°</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>ç”±ä¸»äººä¸ºå°çŒ«ç‰¹åˆ«è®¾è®¡ &copy; 2025</p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å˜é‡
            let currentEntryId = null;
            let diaryEntries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
            
            // DOMå…ƒç´ 
            const entriesContainer = document.getElementById('entries-container');
            const entryTitle = document.getElementById('entry-title');
            const entryEditor = document.getElementById('entry-editor');
            const moodSelector = document.getElementById('mood');
            const tagsInput = document.getElementById('tags');
            const saveBtn = document.getElementById('save-btn');
            const newEntryBtn = document.getElementById('new-entry-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            
            // ç»Ÿè®¡ä¿¡æ¯å…ƒç´ 
            const totalEntriesEl = document.getElementById('total-entries');
            const monthEntriesEl = document.getElementById('month-entries');
            const commonMoodEl = document.getElementById('common-mood');
            const lastEntryEl = document.getElementById('last-entry');
            
            // åˆå§‹åŒ–åº”ç”¨
            initApp();
            
            // åˆå§‹åŒ–åº”ç”¨å‡½æ•°
            function initApp() {
                renderEntries();
                updateStatistics();
                clearEditor();
                
                // å¦‚æœæœ‰æ—¥è®°ï¼Œé€‰ä¸­ç¬¬ä¸€ç¯‡
                if (diaryEntries.length > 0) {
                    selectEntry(diaryEntries[0].id);
                }
            }
            
            // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
            function renderEntries(entries = diaryEntries) {
                entriesContainer.innerHTML = '';
                
                if (entries.length === 0) {
                    entriesContainer.innerHTML = `
                        <div class="empty-state">
                            <p>è¿˜æ²¡æœ‰æ—¥è®°è®°å½•</p>
                            <p>ç‚¹å‡»"å†™æ–°æ—¥è®°"å¼€å§‹è®°å½•å§ï¼</p>
                        </div>
                    `;
                    return;
                }
                
                // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                entries.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = `${entryDate.getFullYear()}-${(entryDate.getMonth() + 1).toString().padStart(2, '0')}-${entryDate.getDate().toString().padStart(2, '0')}`;
                    
                    const entryCard = document.createElement('div');
                    entryCard.className = `entry-card ${entry.id === currentEntryId ? 'selected' : ''}`;
                    entryCard.setAttribute('data-id', entry.id);
                    
                    // è·å–å¿ƒæƒ…å›¾æ ‡
                    const moodIcon = getMoodIcon(entry.mood);
                    
                    entryCard.innerHTML = `
                        <h3>${entry.title || 'æ— æ ‡é¢˜æ—¥è®°'}</h3>
                        <p>${moodIcon} ${formattedDate}</p>
                    `;
                    
                    entryCard.addEventListener('click', () => {
                        selectEntry(entry.id);
                    });
                    
                    entriesContainer.appendChild(entryCard);
                });
            }
            
            // è·å–å¿ƒæƒ…å›¾æ ‡
            function getMoodIcon(mood) {
                const moodIcons = {
                    happy: 'ğŸ˜Š',
                    calm: 'ğŸ˜Œ',
                    sad: 'ğŸ˜¢',
                    angry: 'ğŸ˜ ',
                    excited: 'ğŸ˜ƒ',
                    tired: 'ğŸ˜´',
                    loved: 'ğŸ’•',
                    anxious: 'ğŸ˜°'
                };
                
                return moodIcons[mood] || 'ğŸ˜Š';
            }
            
            // é€‰æ‹©æ—¥è®°æ¡ç›®
            function selectEntry(id) {
                currentEntryId = id;
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.entry-card').forEach(card => {
                    card.classList.remove('selected');
                    if (card.getAttribute('data-id') === id.toString()) {
                        card.classList.add('selected');
                    }
                });
                
                // æŸ¥æ‰¾å¹¶æ˜¾ç¤ºé€‰ä¸­çš„æ—¥è®°
                const selectedEntry = diaryEntries.find(entry => entry.id === id);
                if (selectedEntry) {
                    entryTitle.value = selectedEntry.title || '';
                    entryEditor.value = selectedEntry.content || '';
                    moodSelector.value = selectedEntry.mood || 'happy';
                    tagsInput.value = selectedEntry.tags ? selectedEntry.tags.join(', ') : '';
                }
            }
            
            // æ¸…ç©ºç¼–è¾‘å™¨
            function clearEditor() {
                currentEntryId = null;
                entryTitle.value = '';
                entryEditor.value = '';
                moodSelector.value = 'happy';
                tagsInput.value = '';
                
                // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.entry-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }
            
            // ä¿å­˜æ—¥è®°
            saveBtn.addEventListener('click', () => {
                const title = entryTitle.value.trim();
                const content = entryEditor.value.trim();
                const mood = moodSelector.value;
                const tags = tagsInput.value.split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag !== '');
                
                if (content === '') {
                    alert('æ—¥è®°å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                
                if (currentEntryId) {
                    // æ›´æ–°ç°æœ‰æ—¥è®°
                    const entryIndex = diaryEntries.findIndex(entry => entry.id === currentEntryId);
                    if (entryIndex !== -1) {
                        diaryEntries[entryIndex] = {
                            ...diaryEntries[entryIndex],
                            title,
                            content,
                            mood,
                            tags,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // åˆ›å»ºæ–°æ—¥è®°
                    const newEntry = {
                        id: Date.now(),
                        title,
                        content,
                        mood,
                        tags,
                        date: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    diaryEntries.unshift(newEntry);
                    currentEntryId = newEntry.id;
                }
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('diaryEntries', JSON.stringify(diaryEntries));
                
                // é‡æ–°æ¸²æŸ“åˆ—è¡¨å¹¶é€‰ä¸­å½“å‰æ—¥è®°
                renderEntries();
                updateStatistics();
                selectEntry(currentEntryId);
                
                alert('æ—¥è®°ä¿å­˜æˆåŠŸï¼');
            });
            
            // åˆ›å»ºæ–°æ—¥è®°
            newEntryBtn.addEventListener('click', clearEditor);
            
            // åˆ é™¤æ—¥è®°
            deleteBtn.addEventListener('click', () => {
                if (!currentEntryId) {
                    alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ—¥è®°ï¼');
                    return;
                }
                
                if (confirm('ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„æ—¥è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    diaryEntries = diaryEntries.filter(entry => entry.id !== currentEntryId);
                    localStorage.setItem('diaryEntries', JSON.stringify(diaryEntries));
                    
                    clearEditor();
                    renderEntries();
                    updateStatistics();
                    
                    alert('æ—¥è®°å·²åˆ é™¤ï¼');
                }
            });
            
            // æœç´¢æ—¥è®°
            searchBtn.addEventListener('click', () => {
                const searchTerm = searchInput.value.trim().toLowerCase();
                
                if (searchTerm === '') {
                    renderEntries();
                    return;
                }
                
                const filteredEntries = diaryEntries.filter(entry => {
                    const titleMatch = entry.title.toLowerCase().includes(searchTerm);
                    const contentMatch = entry.content.toLowerCase().includes(searchTerm);
                    const tagMatch = entry.tags && entry.tags.some(tag => 
                        tag.toLowerCase().includes(searchTerm)
                    );
                    
                    return titleMatch || contentMatch || tagMatch;
                });
                
                renderEntries(filteredEntries);
                
                if (filteredEntries.length === 0) {
                    entriesContainer.innerHTML = `
                        <div class="empty-state">
                            <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥è®°</p>
                        </div>
                    `;
                }
            });
            
            // æœç´¢æ¡†æŒ‰Enteré”®è§¦å‘æœç´¢
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            function updateStatistics() {
                totalEntriesEl.textContent = diaryEntries.length;
                
                // æœ¬æœˆæ—¥è®°æ•°
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const monthEntries = diaryEntries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() === currentMonth && 
                           entryDate.getFullYear() === currentYear;
                });
                monthEntriesEl.textContent = monthEntries.length;
                
                // æœ€å¸¸ç”¨å¿ƒæƒ…
                if (diaryEntries.length > 0) {
                    const moodCount = {};
                    diaryEntries.forEach(entry => {
                        moodCount[entry.mood] = (moodCount[entry.mood] || 0) + 1;
                    });
                    
                    let commonMood = Object.keys(moodCount)[0];
                    let maxCount = moodCount[commonMood];
                    
                    for (const mood in moodCount) {
                        if (moodCount[mood] > maxCount) {
                            maxCount = moodCount[mood];
                            commonMood = mood;
                        }
                    }
                    
                    const moodNames = {
                        happy: 'å¼€å¿ƒ',
                        calm: 'å¹³é™',
                        sad: 'ä¼¤å¿ƒ',
                        angry: 'ç”Ÿæ°”',
                        excited: 'å…´å¥‹',
                        tired: 'ç–²æƒ«',
                        loved: 'è¢«çˆ±',
                        anxious: 'ç„¦è™‘'
                    };
                    
                    commonMoodEl.textContent = `${getMoodIcon(commonMood)} ${moodNames[commonMood]}`;
                }
                
                // æœ€è¿‘ä¸€æ¬¡è®°å½•
                if (diaryEntries.length > 0) {
                    const sortedEntries = [...diaryEntries].sort((a, b) => 
                        new Date(b.date) - new Date(a.date)
                    );
                    const lastEntry = new Date(sortedEntries[0].date);
                    lastEntryEl.textContent = `${lastEntry.getFullYear()}-${(lastEntry.getMonth() + 1).toString().padStart(2, '0')}-${lastEntry.getDate().toString().padStart(2, '0')}`;
                }
            }
        });
    </script>
</body>
</html>
