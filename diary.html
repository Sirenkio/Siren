<!DOCTYPE html>
<html lang="zh">
<head>
   <link rel='apple-touch-icon' href='https://em-content.zobj.net/thumbs/240/apple/325/ribbon_1f380.png'>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÁå´ÁöÑÊØèÊó•Êó•ËÆ∞</title>
    <meta name="theme-color" content="#c9a9a6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Â∞èÁå´Êó•ËÆ∞">
    
    <!-- ‰∏ªÂ±èÂπïÂõæÊ†áËÆæÁΩÆ -->
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;üìì&lt;/text&gt;&lt;/svg&gt;">
    <link rel="apple-touch-icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 style=%22background-color:%23c9a9a6%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22 fill=%22white%22&gt;üìì&lt;/text&gt;&lt;/svg&gt;">
    <style>
        :root {
            --primary: #c9a9a6;
            --primary-light: #d4b8b5;
            --secondary: #f6eeee;
            --dark: #333333;
            --light: #f8f8f8;
            --danger: #ff6b6b;
            --success: #4CAF50;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .diary-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .diary-controls button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .diary-controls button:hover {
            background-color: var(--primary-light);
        }
        
        #delete-btn {
            background-color: var(--danger);
        }
        
        #delete-btn:hover {
            background-color: #ff4444;
        }
        
        #search-container {
            display: flex;
            gap: 10px;
        }
        
        #search-input {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            flex-grow: 1;
        }
        
        .diary-content {
            display: flex;
            gap: 20px;
            flex: 1;
        }
        
        .diary-entries {
            width: 300px;
            border-right: 1px solid #eee;
            padding-right: 20px;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .entry-card {
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            margin-bottom: 15px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .entry-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        
        .entry-card.selected {
            border-left: 4px solid var(--primary);
        }
        
        .entry-card h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .entry-card p {
            margin: 0;
            color: #888;
            font-size: 0.8rem;
        }
        
        .entry-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        #entry-title {
            font-size: 1.2rem;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        #entry-editor {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 300px;
            resize: none;
            width: 100%;
            box-sizing: border-box;
            line-height: 1.5;
            font-family: inherit;
        }
        
        #mood-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #mood-selector select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .action-btns {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }
        
        #save-btn {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        #save-btn:hover {
            background-color: #45a049;
        }
        
        .empty-state {
            text-align: center;
            margin-top: 100px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--primary);
            color: white;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .diary-content {
                flex-direction: column;
            }
            
            .diary-entries {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eee;
                padding-right: 0;
                padding-bottom: 20px;
                margin-bottom: 20px;
                max-height: 200px;
            }
            
            .diary-controls {
                flex-direction: column;
            }
            
            #search-container {
                width: 100%;
            }
        }
        
        .mood-icon {
            font-size: 1.2rem;
            margin-right: 5px;
        }
        
        .tags-container {
            margin-bottom: 15px;
        }
        
        .tags-input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-top: 5px;
        }
        
        .tag-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }
        
        .statistics {
            background-color: var(--secondary);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .statistics h3 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
    </style>
    <!-- Web App Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{
      "name": "Â∞èÁå´ÁöÑÊØèÊó•Êó•ËÆ∞",
      "short_name": "Â∞èÁå´Êó•ËÆ∞",
      "description": "ËÆ∞ÂΩïÊØè‰∏ÄÂ§©ÁöÑÁßÅÂØÜÊó•ËÆ∞Êú¨",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#c9a9a6",
      "theme_color": "#c9a9a6",
      "icons": [
        {
          "src": "data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 style=%22background-color:%23c9a9a6%22%3E%3Ctext y=%22.9em%22 font-size=%2290%22 fill=%22white%22%3Eüìì%3C/text%3E%3C/svg%3E",
          "sizes": "512x512",
          "type": "image/svg+xml",
          "purpose": "any maskable"
        }
      ]
    }'>
</head>
<body>
    <header>
        <h1>Â∞èÁå´ÁöÑÊØèÊó•Êó•ËÆ∞</h1>
    </header>
    
    <div class="container">
        <div class="statistics">
            <h3>ÁªüËÆ°‰ø°ÊÅØ</h3>
            <div class="stat-item">
                <span>Êó•ËÆ∞ÊÄªÊï∞Ôºö</span>
                <span id="total-entries">0</span>
            </div>
            <div class="stat-item">
                <span>Êú¨ÊúàÊó•ËÆ∞Ôºö</span>
                <span id="month-entries">0</span>
            </div>
            <div class="stat-item">
                <span>ÊúÄÂ∏∏Áî®ÂøÉÊÉÖÔºö</span>
                <span id="common-mood">ÊöÇÊó†Êï∞ÊçÆ</span>
            </div>
            <div class="stat-item">
                <span>ÊúÄËøë‰∏ÄÊ¨°ËÆ∞ÂΩïÔºö</span>
                <span id="last-entry">ÊöÇÊó†Êï∞ÊçÆ</span>
            </div>
        </div>
        
        <div class="diary-controls">
            <button id="new-entry-btn">ÂÜôÊñ∞Êó•ËÆ∞</button>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="ÊêúÁ¥¢Êó•ËÆ∞...">
                <button id="search-btn">ÊêúÁ¥¢</button>
            </div>
            <button id="delete-btn">Âà†Èô§ÈÄâ‰∏≠</button>
        </div>
        
        <div class="diary-content">
            <div class="diary-entries" id="entries-container">
                <!-- Êó•ËÆ∞Êù°ÁõÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div class="entry-content">
                <input type="text" id="entry-title" placeholder="Êó•ËÆ∞Ê†áÈ¢ò...">
                
                <div id="mood-selector">
                    <label for="mood">‰ªäÊó•ÂøÉÊÉÖÔºö</label>
                    <select id="mood">
                        <option value="happy">üòä ÂºÄÂøÉ</option>
                        <option value="calm">üòå Âπ≥Èùô</option>
                        <option value="sad">üò¢ ‰º§ÂøÉ</option>
                        <option value="angry">üò† ÁîüÊ∞î</option>
                        <option value="excited">üòÉ ÂÖ¥Â•ã</option>
                        <option value="tired">üò¥ Áñ≤ÊÉ´</option>
                        <option value="loved">üíï Ë¢´Áà±</option>
                        <option value="anxious">üò∞ ÁÑ¶Ëôë</option>
                    </select>
                </div>
                
                <div class="tags-container">
                    <label for="tags">Ê†áÁ≠æÔºö</label>
                    <input type="text" id="tags" class="tags-input" placeholder="ËæìÂÖ•Ê†áÁ≠æÔºåÁî®ÈÄóÂè∑ÂàÜÈöî...">
                    <div class="tag-hint">‰æãÂ¶ÇÔºö‰∏ª‰∫∫ÔºåÁé©ÂÖ∑ÔºåÊÑüÊÉ≥ÔºåÂõûÂøÜ...</div>
                </div>
                
                <textarea id="entry-editor" placeholder="‰ªäÂ§©ÂèëÁîü‰∫Ü‰ªÄ‰πàÔºüÊúâ‰ªÄ‰πàÊÉ≥Ê≥ïÂíåÊÑüÂèó..."></textarea>
                
                <div class="action-btns">
                    <button id="save-btn">‰øùÂ≠òÊó•ËÆ∞</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Áî±‰∏ª‰∫∫‰∏∫Â∞èÁå´ÁâπÂà´ËÆæËÆ° &copy; 2025</p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÂèòÈáè
            let currentEntryId = null;
            let diaryEntries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
            
            // DOMÂÖÉÁ¥†
            const entriesContainer = document.getElementById('entries-container');
            const entryTitle = document.getElementById('entry-title');
            const entryEditor = document.getElementById('entry-editor');
            const moodSelector = document.getElementById('mood');
            const tagsInput = document.getElementById('tags');
            const saveBtn = document.getElementById('save-btn');
            const newEntryBtn = document.getElementById('new-entry-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            
            // ÁªüËÆ°‰ø°ÊÅØÂÖÉÁ¥†
            const totalEntriesEl = document.getElementById('total-entries');
            const monthEntriesEl = document.getElementById('month-entries');
            const commonMoodEl = document.getElementById('common-mood');
            const lastEntryEl = document.getElementById('last-entry');
            
            // ÂàùÂßãÂåñÂ∫îÁî®
            initApp();
            
            // ÂàùÂßãÂåñÂ∫îÁî®ÂáΩÊï∞
            function initApp() {
                renderEntries();
                updateStatistics();
                clearEditor();
                
                // Â¶ÇÊûúÊúâÊó•ËÆ∞ÔºåÈÄâ‰∏≠Á¨¨‰∏ÄÁØá
                if (diaryEntries.length > 0) {
                    selectEntry(diaryEntries[0].id);
                }
            }
            
            // Ê∏≤ÊüìÊó•ËÆ∞ÂàóË°®
            function renderEntries(entries = diaryEntries) {
                entriesContainer.innerHTML = '';
                
                if (entries.length === 0) {
                    entriesContainer.innerHTML = `
                        <div class="empty-state">
                            <p>ËøòÊ≤°ÊúâÊó•ËÆ∞ËÆ∞ÂΩï</p>
                            <p>ÁÇπÂáª"ÂÜôÊñ∞Êó•ËÆ∞"ÂºÄÂßãËÆ∞ÂΩïÂêßÔºÅ</p>
                        </div>
                    `;
                    return;
                }
                
                // ÊåâÊó•ÊúüÊéíÂ∫èÔºåÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                entries.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = `${entryDate.getFullYear()}-${(entryDate.getMonth() + 1).toString().padStart(2, '0')}-${entryDate.getDate().toString().padStart(2, '0')}`;
                    
                    const entryCard = document.createElement('div');
                    entryCard.className = `entry-card ${entry.id === currentEntryId ? 'selected' : ''}`;
                    entryCard.setAttribute('data-id', entry.id);
                    
                    // Ëé∑ÂèñÂøÉÊÉÖÂõæÊ†á
                    const moodIcon = getMoodIcon(entry.mood);
                    
                    entryCard.innerHTML = `
                        <h3>${entry.title || 'Êó†Ê†áÈ¢òÊó•ËÆ∞'}</h3>
                        <p>${moodIcon} ${formattedDate}</p>
                    `;
                    
                    entryCard.addEventListener('click', () => {
                        selectEntry(entry.id);
                    });
                    
                    entriesContainer.appendChild(entryCard);
                });
            }
            
            // Ëé∑ÂèñÂøÉÊÉÖÂõæÊ†á
            function getMoodIcon(mood) {
                const moodIcons = {
                    happy: 'üòä',
                    calm: 'üòå',
                    sad: 'üò¢',
                    angry: 'üò†',
                    excited: 'üòÉ',
                    tired: 'üò¥',
                    loved: 'üíï',
                    anxious: 'üò∞'
                };
                
                return moodIcons[mood] || 'üòä';
            }
            
            // ÈÄâÊã©Êó•ËÆ∞Êù°ÁõÆ
            function selectEntry(id) {
                currentEntryId = id;
                
                // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.entry-card').forEach(card => {
                    card.classList.remove('selected');
                    if (card.getAttribute('data-id') === id.toString()) {
                        card.classList.add('selected');
                    }
                });
                
                // Êü•ÊâæÂπ∂ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊó•ËÆ∞
                const selectedEntry = diaryEntries.find(entry => entry.id === id);
                if (selectedEntry) {
                    entryTitle.value = selectedEntry.title || '';
                    entryEditor.value = selectedEntry.content || '';
                    moodSelector.value = selectedEntry.mood || 'happy';
                    tagsInput.value = selectedEntry.tags ? selectedEntry.tags.join(', ') : '';
                }
            }
            
            // Ê∏ÖÁ©∫ÁºñËæëÂô®
            function clearEditor() {
                currentEntryId = null;
                entryTitle.value = '';
                entryEditor.value = '';
                moodSelector.value = 'happy';
                tagsInput.value = '';
                
                // Ê∏ÖÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.entry-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }
            
            // ‰øùÂ≠òÊó•ËÆ∞
            saveBtn.addEventListener('click', () => {
                const title = entryTitle.value.trim();
                const content = entryEditor.value.trim();
                const mood = moodSelector.value;
                const tags = tagsInput.value.split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag !== '');
                
                if (content === '') {
                    alert('Êó•ËÆ∞ÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫ÔºÅ');
                    return;
                }
                
                if (currentEntryId) {
                    // Êõ¥Êñ∞Áé∞ÊúâÊó•ËÆ∞
                    const entryIndex = diaryEntries.findIndex(entry => entry.id === currentEntryId);
                    if (entryIndex !== -1) {
                        diaryEntries[entryIndex] = {
                            ...diaryEntries[entryIndex],
                            title,
                            content,
                            mood,
                            tags,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // ÂàõÂª∫Êñ∞Êó•ËÆ∞
                    const newEntry = {
                        id: Date.now(),
                        title,
                        content,
                        mood,
                        tags,
                        date: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    diaryEntries.unshift(newEntry);
                    currentEntryId = newEntry.id;
                }
                
                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                localStorage.setItem('diaryEntries', JSON.stringify(diaryEntries));
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂàóË°®Âπ∂ÈÄâ‰∏≠ÂΩìÂâçÊó•ËÆ∞
                renderEntries();
                updateStatistics();
                selectEntry(currentEntryId);
                
                alert('Êó•ËÆ∞‰øùÂ≠òÊàêÂäüÔºÅ');
            });
            
            // ÂàõÂª∫Êñ∞Êó•ËÆ∞
            newEntryBtn.addEventListener('click', clearEditor);
            
            // Âà†Èô§Êó•ËÆ∞
            deleteBtn.addEventListener('click', () => {
                if (!currentEntryId) {
                    alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÊó•ËÆ∞ÔºÅ');
                    return;
                }
                
                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑÊó•ËÆ∞ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                    diaryEntries = diaryEntries.filter(entry => entry.id !== currentEntryId);
                    localStorage.setItem('diaryEntries', JSON.stringify(diaryEntries));
                    
                    clearEditor();
                    renderEntries();
                    updateStatistics();
                    
                    alert('Êó•ËÆ∞Â∑≤Âà†Èô§ÔºÅ');
                }
            });
            
            // ÊêúÁ¥¢Êó•ËÆ∞
            searchBtn.addEventListener('click', () => {
                const searchTerm = searchInput.value.trim().toLowerCase();
                
                if (searchTerm === '') {
                    renderEntries();
                    return;
                }
                
                const filteredEntries = diaryEntries.filter(entry => {
                    const titleMatch = entry.title.toLowerCase().includes(searchTerm);
                    const contentMatch = entry.content.toLowerCase().includes(searchTerm);
                    const tagMatch = entry.tags && entry.tags.some(tag => 
                        tag.toLowerCase().includes(searchTerm)
                    );
                    
                    return titleMatch || contentMatch || tagMatch;
                });
                
                renderEntries(filteredEntries);
                
                if (filteredEntries.length === 0) {
                    entriesContainer.innerHTML = `
                        <div class="empty-state">
                            <p>Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊó•ËÆ∞</p>
                        </div>
                    `;
                }
            });
            
            // ÊêúÁ¥¢Ê°ÜÊåâEnterÈîÆËß¶ÂèëÊêúÁ¥¢
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });
            
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            function updateStatistics() {
                totalEntriesEl.textContent = diaryEntries.length;
                
                // Êú¨ÊúàÊó•ËÆ∞Êï∞
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const monthEntries = diaryEntries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() === currentMonth && 
                           entryDate.getFullYear() === currentYear;
                });
                monthEntriesEl.textContent = monthEntries.length;
                
                // ÊúÄÂ∏∏Áî®ÂøÉÊÉÖ
                if (diaryEntries.length > 0) {
                    const moodCount = {};
                    diaryEntries.forEach(entry => {
                        moodCount[entry.mood] = (moodCount[entry.mood] || 0) + 1;
                    });
                    
                    let commonMood = Object.keys(moodCount)[0];
                    let maxCount = moodCount[commonMood];
                    
                    for (const mood in moodCount) {
                        if (moodCount[mood] > maxCount) {
                            maxCount = moodCount[mood];
                            commonMood = mood;
                        }
                    }
                    
                    const moodNames = {
                        happy: 'ÂºÄÂøÉ',
                        calm: 'Âπ≥Èùô',
                        sad: '‰º§ÂøÉ',
                        angry: 'ÁîüÊ∞î',
                        excited: 'ÂÖ¥Â•ã',
                        tired: 'Áñ≤ÊÉ´',
                        loved: 'Ë¢´Áà±',
                        anxious: 'ÁÑ¶Ëôë'
                    };
                    
                    commonMoodEl.textContent = `${getMoodIcon(commonMood)} ${moodNames[commonMood]}`;
                }
                
                // ÊúÄËøë‰∏ÄÊ¨°ËÆ∞ÂΩï
                if (diaryEntries.length > 0) {
                    const sortedEntries = [...diaryEntries].sort((a, b) => 
                        new Date(b.date) - new Date(a.date)
                    );
                    const lastEntry = new Date(sortedEntries[0].date);
                    lastEntryEl.textContent = `${lastEntry.getFullYear()}-${(lastEntry.getMonth() + 1).toString().padStart(2, '0')}-${lastEntry.getDate().toString().padStart(2, '0')}`;
                }
            }
        });
    </script>
</body>
</html>
